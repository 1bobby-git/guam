<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>괌 4박5일 가족여행 플래너 — 스티키 & 근접옵션 자동정렬</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root{
    --bg:#f8fafc; --card:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0;
    --brand:#06b6d4; --ok:#16a34a; --chip:#e2f6ff; --warn:#fb923c;
  }
  *{box-sizing:border-box}
  html, body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif;
    overflow-y:scroll;
  }

  .wrap{max-width:1180px;margin:20px auto;padding:0 16px}
  h1{margin:0 0 6px;font-size:26px}
  .sub{color:var(--muted);margin-bottom:14px}

  .layout{
    display:grid;
    grid-template-columns:minmax(0,1fr) 420px;
    gap:16px;
    align-items:start;
  }
  @media (max-width:1099px){
    .layout{grid-template-columns:1fr}
  }

  .mapcol{position:relative}
  .planecol{position:relative}
  .stickyWrap{
    position:sticky; top:72px; z-index:2;
  }
  @media (max-width:1099px){
    .stickyWrap{position:static; top:auto}
  }

  .card{background:#fff;border:1px solid var(--line);border-radius:14px}
  .card h2{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);font-size:15px;color:#0b2a33}
  .card .body{padding:12px}

  .days{display:flex;gap:8px;flex-wrap:wrap;margin:0 0 12px}
  .daybtn{border:1px solid var(--line);background:#fff;padding:9px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  .daybtn.active{background:linear-gradient(135deg,#7dd3fc,#22d3ee);color:#052e3f;border-color:transparent}

  .panel{display:none}
  .panel.active{display:block}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{display:flex;justify-content:space-between;gap:8px;padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff}
  .item.optionA{border-style:dashed}
  .item.optionB{border-style:dotted}
  .item-left{display:flex;gap:10px;align-items:center;min-width:0}
  .dot{width:9px;height:9px;border-radius:50%;background:var(--brand);box-shadow:0 0 0 3px rgba(34,211,238,.18)}
  .title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:300px}
  .mini{color:var(--muted);font-size:12px}
  .badges{display:flex;gap:6px;align-items:center}
  .badge{font-size:12px;background:#dcfce7;color:#065f46;border:1px solid #bbf7d0;padding:4px 8px;border-radius:999px}
  .badge.free{background:#f1f5f9;color:#334155;border-color:#e2e8f0}
  .badge.hot{background:#fff7ed;color:#9a3412;border-color:#fed7aa}
  .row-sum{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{border:1px solid var(--line);background:var(--chip);padding:6px 10px;border-radius:999px;font-size:13px}
  .sum{color:var(--ok);font-weight:800}

  #map{width:100%;height:460px;border-radius:12px;overflow:hidden}
  .map-note{margin-top:6px;color:var(--muted);font-size:12px}

  .hoverfixed{
    position:fixed; right:16px; top:90px; width:340px; max-height:72vh;
    background:#fff;border:1px solid var(--line);border-radius:12px;
    box-shadow:0 12px 28px rgba(2,132,199,.15); padding:12px; display:none; z-index:3; overflow:auto
  }
  .hoverfixed.show{display:block}
  .hoverfixed h3{margin:0 0 6px;font-size:14px}
  .hoverfixed p{margin:0;color:var(--muted);font-size:12px;line-height:1.55}
  @media (max-width:1099px){
    .hoverfixed{left:12px; right:12px; bottom:12px; top:auto; width:auto; max-height:40vh}
  }

  .sections{margin:18px 0;display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:980px){.sections{grid-template-columns:1fr}}
  .sect h3{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);font-size:15px;color:#0b2a33}
  .sect .body{padding:12px}
  .sect ul{margin:0;padding-left:18px;color:var(--muted);line-height:1.6}
  .sect li{margin:6px 0}
</style>
</head>
<body>
<div class="wrap">
  <h1>괌 4박5일 가족여행 플래너</h1>
  <div class="sub">두짓타니(16–18) → 롯데호텔(18–20) · 이동 최소 · 바다·수영 중심 · 아침 포케 / 점심 햄버거 / 저녁 BBQ+맥주</div>

  <div class="layout">
    <!-- 좌: 지도/예산 -->
    <div class="col mapcol">
      <div class="card">
        <h2>지도</h2>
        <div class="body">
          <div id="map"></div>
          <div class="map-note">리스트/마커에 마우스를 올리면 우측 패널에 정보가 표시됩니다.</div>
        </div>
      </div>
      <div class="card" style="margin-top:16px">
        <h2>예산</h2>
        <div class="body"><div id="budgetBox"></div></div>
      </div>
    </div>

    <!-- 우: 일정(스티키 래퍼) -->
    <div class="col planecol">
      <div class="stickyWrap">
        <div class="days" id="dayControls"></div>
        <div id="panels"></div>
      </div>
    </div>
  </div>

  <!-- 안내 섹션 -->
  <div class="sections">
    <div class="card sect">
      <h3>운전 & 교통</h3>
      <div class="body">
        <ul>
          <li>차 안에 물건 두지 않기(도난 위험).</li>
          <li>파랑/빨강선 주차금지, 갓길 주차 금지, 스쿨버스 스탑 시 주행 금지.</li>
          <li>포트홀·중앙차선 진입 차량·좌우회전 동시차선 주의.</li>
          <li>STOP 표지판 3초 정지, 반납 전 주유.</li>
        </ul>
      </div>
    </div>
    <div class="card sect">
      <h3>의상 & 준비물</h3>
      <div class="body">
        <ul>
          <li>선글라스 필수. 흰 원피스/셔츠, 밝은 반바지 추천.</li>
          <li>습기제거제, 일회용세제, 섬유유연제, 보조배터리, 약상자, 수분진정팩, 김, 설거지 용품, 삼각대, 이중문잠금장치, 압축파우치.</li>
          <li>마이쭈(이동 중 간식), <strong>미니 카봇</strong>(작은 장난감) 추가 준비.</li>
        </ul>
      </div>
    </div>
    <div class="card sect">
      <h3>언어 & 문화</h3>
      <div class="body">
        <ul>
          <li>하파데이 = 안녕하세요.</li>
          <li>멀릭 = 맛있어.</li>
          <li>씨쥬스마아씨 = 고마워요.</li>
        </ul>
      </div>
    </div>
    <div class="card sect">
      <h3>음식 & 식당 추천</h3>
      <div class="body">
        <ul>
          <li>로컬: Ron’s Diner, Meskla Chamoru Fusion Bistro</li>
          <li>BBQ: Proa, Heavy Hitters</li>
          <li>햄버거: Meskla Dos, Mosa’s</li>
          <li>브런치: Eggs ’n Things(평균 대기 40분)</li>
          <li>몰/간단식: GPO, Donki, Onigiri Seven</li>
          <li>카페: Mighty Purple’s, Slow Walk Cafe</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- 우측 고정 정보 패널 -->
<div class="hoverfixed" id="hoverFixed">
  <h3 id="hoverTitle">장소 정보</h3>
  <p id="hoverText">리스트/마커에 마우스를 올리면 이곳에 표시됩니다.</p>
</div>

<script>
  /* ===== 원본 데이터 (옵션 포함, 위치는 대략) ===== */
  var itinerary = [
    { day:1, title:"DAY 1 — 도착·마트·수영 (두짓타니)", steps:[
      { name:"두짓타니 체크인", info:"체크인 및 짐 정리", type:"hotel", budget:0, lat:13.5130, lng:144.8070 },
      { name:"K Mart (404 N Marine Dr)", info:"생수·간식·아침용 포케·맥주 구매", type:"market", budget:40, lat:13.4873, lng:144.7820 },
      { name:"Tumon Beach", info:"산책 및 가벼운 물놀이", type:"beach", budget:0, lat:13.5105, lng:144.8049 },
      { name:"호텔 수영장", info:"유아풀 위주 이용", type:"pool", budget:0, lat:13.5131, lng:144.8072 },
      { name:"Tasi Grill (두짓타니 내)", info:"저녁: Tasi Burger, Fish & Chips, 맥주", type:"bbq", budget:60, lat:13.5131, lng:144.8072 },
      { name:"(옵션 A) Japanese Fastfood", info:"저녁 대체: 무스비·우동 등 간단식", type:"burger", budget:40, lat:13.5115, lng:144.8065, opt:"A" },
      { name:"(옵션 B) GPO 푸드코트/팬더익스프레스", info:"저녁 대체: 오렌지치킨·Beef&Broccoli / 하겐다즈", type:"mall", budget:45, lat:13.4867, lng:144.7822, opt:"B" }
    ]},
    { day:2, title:"DAY 2 — 바다·수영·BBQ (두짓타니)", steps:[
      { name:"Onigiri Seven", info:"아침: 포케볼", type:"poke", budget:20, lat:13.5113, lng:144.8063 },
      { name:"Tumon Beach", info:"오전 물놀이", type:"beach", budget:0, lat:13.5105, lng:144.8049 },
      { name:"호텔 수영장", info:"점심 전후 휴식/수영", type:"pool", budget:0, lat:13.5131, lng:144.8072 },
      { name:"Meskla Dos", info:"점심: Badass Burger", type:"burger", budget:35, lat:13.5119, lng:144.8079 },
      { name:"GPO / K Mart", info:"오후 쇼핑·보충 구매", type:"market", budget:10, lat:13.4867, lng:144.7822 },
      { name:"Proa Restaurant", info:"저녁: BBQ 플래터 + 맥주", type:"bbq", budget:70, lat:13.5124, lng:144.8090 },
      { name:"(옵션 A) Heavy Hitters BBQ", info:"★ 강추! 가족형 바비큐 플래터 + 맥주, 현지 인기 BBQ 스팟", type:"bbq", budget:65, lat:13.5140, lng:144.8100, opt:"A", highlight:true }
    ]},
    { day:3, title:"DAY 3 — 숙소 이동·여유 (롯데호텔)", steps:[
      { name:"롯데호텔 체크인", info:"체크인 및 수영/해변", type:"hotel", budget:0, lat:13.5161, lng:144.8060 },
      { name:"호텔 수영장", info:"아이들과 수영", type:"pool", budget:0, lat:13.5161, lng:144.8060 },
      { name:"Mosa’s", info:"점심: 햄버거 + 포케볼", type:"burger", budget:40, lat:13.5103, lng:144.8082 },
      { name:"솔레다드 요새", info:"전망 포인트(차 10분)", type:"spot", budget:0, lat:13.4653, lng:144.7450 },
      { name:"Ron’s Diner", info:"저녁: 차모로 BBQ + 맥주", type:"bbq", budget:65, lat:13.5092, lng:144.8100 },
      { name:"(옵션 B) Longhorn Steakhouse", info:"스테이크 & 와인 / 아메리칸 스타일 스테이크하우스", type:"bbq", budget:80, lat:13.5095, lng:144.8103, opt:"B" },
      { name:"(옵션 B) 비키니 아일랜드 투어", info:"Agat Marina 출발 단거리 해상 체험", type:"spot", budget:90, lat:13.3860, lng:144.6580, opt:"B" },
      { name:"(옵션 B) 탈리팍 다리 (Talifak Bridge)", info:"남부 역사 포인트(포토스팟)", type:"spot", budget:0, lat:13.3690, lng:144.6710, opt:"B" }
    ]},
    { day:4, title:"DAY 4 — 수영·카페·선셋 디너 (롯데호텔)", steps:[
      { name:"ABC Store (Tumon)", info:"아침: 포케볼 또는 과일컵", type:"poke", budget:20, lat:13.5108, lng:144.8053 },
      { name:"Tumon Beach", info:"해변·스노클·모래놀이", type:"beach", budget:0, lat:13.5105, lng:144.8049 },
      { name:"(옵션 A) Ritidian Beach", info:"천연 해변 / 가족 사진 명소 (차량 접근 전용도로 주의)", type:"beach", budget:0, lat:13.6500, lng:144.8670, opt:"A" },
      { name:"(옵션 A) Emerald Valley", info:"자연 계곡 · 에메랄드빛 물색 포인트 (포토 스팟)", type:"spot", budget:0, lat:13.6525, lng:144.8615, opt:"A" },
      { name:"롯데호텔 수영장", info:"낮잠 후 수영", type:"pool", budget:0, lat:13.5161, lng:144.8060 },
      { name:"Meskla Chamoru Fusion Bistro", info:"점심: 로컬 플레이트/버거", type:"burger", budget:35, lat:13.5114, lng:144.8072 },
      { name:"Slow Walk Cafe", info:"커피·디저트(얼음X)", type:"cafe", budget:12, lat:13.5127, lng:144.8058 },
      { name:"The Beach Bar (Gun Beach)", info:"저녁: 선셋뷰 · BBQ & 칵테일/맥주 · 아이들 모래놀이 OK", type:"bbq", budget:75, lat:13.5240, lng:144.8065 },
      { name:"(옵션 B) Tumon Sunday Night Market", info:"혼잡/대기 감수 시: 야시장 간식 투어", type:"bbq", budget:60, lat:13.5122, lng:144.8044, opt:"B" },
      { name:"(옵션 A) Mighty Purple’s", info:"아사이볼·주스·디저트 / 추천 메뉴: 아사이볼", type:"cafe", budget:14, lat:13.5150, lng:144.8060, opt:"A" },
      { name:"(옵션 B) Donki(돈키호테) 몰", info:"야시장 혼잡 시 대체: 쇼핑+간단식(무료 셔틀)", type:"mall", budget:0, lat:13.5120, lng:144.8085, opt:"B" }
    ]},
    { day:5, title:"DAY 5 — 귀국 준비", steps:[
      { name:"롯데호텔 체크아웃", info:"짐 정리 및 출발 준비", type:"hotel", budget:0, lat:13.5161, lng:144.8060 },
      { name:"K Mart (Tamuning)", info:"기념품·간식 마지막 쇼핑", type:"market", budget:15, lat:13.4873, lng:144.7820 },
      { name:"Dream Rent a Car", info:"반납 및 공항 이동", type:"spot", budget:0, lat:13.5077, lng:144.8079 },
      { name:"(옵션 A) GPO(Guam Premier Outlets)", info:"출국 전 쇼핑(푸드코트 포함)", type:"mall", budget:0, lat:13.4867, lng:144.7822, opt:"A" }
    ]}
  ];

  var controls = document.getElementById('dayControls');
  var panels = document.getElementById('panels');
  var map, markerLayer, currentMarkers = [];

  /* ===== 거리/Haversine ===== */
  function rad(v){ return v * Math.PI / 180; }
  function distKm(aLat, aLng, bLat, bLng){
    var R = 6371, dLat = rad(bLat - aLat), dLng = rad(bLng - aLng);
    var sa = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(rad(aLat))*Math.cos(rad(bLat))*sin2(dLng/2);
    var c = 2 * Math.atan2(Math.sqrt(sa), Math.sqrt(1-sa));
    return R * c;
  }
  function sin2(x){ var s=Math.sin(x); return s*s; }

  /* ===== 옵션을 가장 가까운 본 항목 바로 아래로 재배치 ===== */
  function reorderOptionsForDay(dayObj){
    var base = [], opts = [], i;
    for(i=0;i<dayObj.steps.length;i++){
      var s = dayObj.steps[i];
      if(s.opt){ opts.push(s); } else { base.push(s); }
    }
    if(opts.length===0){ return dayObj.steps; }

    var groups = [], j;
    for(i=0;i<base.length;i++){ groups.push([]); }
    for(i=0;i<opts.length;i++){
      var o = opts[i], minD = 1e9, minIdx = 0;
      for(j=0;j<base.length;j++){
        var b = base[j];
        var d = distKm(o.lat, o.lng, b.lat, b.lng);
        if(d < minD){ minD = d; minIdx = j; }
      }
      groups[minIdx].push(o);
    }
    var merged = [];
    for(i=0;i<base.length;i++){
      merged.push(base[i]);
      if(groups[i] && groups[i].length){
        var k; for(k=0;k<groups[i].length;k++){ merged.push(groups[i][k]); }
      }
    }
    return merged;
  }

  function reorderAllDays(){
    var i;
    for(i=0;i<itinerary.length;i++){
      itinerary[i].steps = reorderOptionsForDay(itinerary[i]);
    }
  }

  /* ===== 유틸 ===== */
  function currency(n){ return "$" + n.toFixed(0); }
  function daySum(obj){ var s=0,i; for(i=0;i<obj.steps.length;i++){ s += (obj.steps[i].budget||0); } return s; }
  function totalSum(){ var t=0,i; for(i=0;i<itinerary.length;i++){ t += daySum(itinerary[i]); } return t; }
  function getDay(d){ var i; for(i=0;i<itinerary.length;i++){ if(itinerary[i].day===d) return itinerary[i]; } return itinerary[0]; }

  /* ===== UI ===== */
  function makeDayButton(obj, idx){
    var b = document.createElement('button');
    b.className = 'daybtn' + (idx===0?' active':'');
    b.textContent = 'DAY ' + obj.day;
    b.setAttribute('data-day', obj.day);
    b.onclick = function(){ activateDay(obj.day); };
    return b;
  }

  function makePanel(obj, idx){
    var wrap = document.createElement('div');
    wrap.className = 'panel card' + (idx===0?' active':'');
    var h = document.createElement('h2'); h.textContent = obj.title;
    var body = document.createElement('div'); body.className = 'body';
    var list = document.createElement('div'); list.className = 'list';

    var i;
    for(i=0;i<obj.steps.length;i++){
      var s = obj.steps[i];
      var item = document.createElement('div');
      item.className = 'item' + (s.opt==='A'?' optionA':(s.opt==='B'?' optionB':''));
      item.setAttribute('data-lat', s.lat); item.setAttribute('data-lng', s.lng);
      item.setAttribute('data-name', s.name); item.setAttribute('data-info', s.info);

      item.onmouseenter = function(e){
        var n = e.currentTarget.getAttribute('data-name');
        var info = e.currentTarget.getAttribute('data-info');
        showHover(n, info, parseFloat(e.currentTarget.getAttribute('data-lat')), parseFloat(e.currentTarget.getAttribute('data-lng')));
      };
      item.onmouseleave = function(){ hideHover(); };

      var left = document.createElement('div'); left.className = 'item-left';
      var dot = document.createElement('span'); dot.className = 'dot';

      var tx = document.createElement('div');
      var ttl = document.createElement('div'); ttl.className='title'; ttl.textContent = s.name;
      var mini = document.createElement('div'); mini.className='mini'; mini.textContent = s.info;
      tx.appendChild(ttl); tx.appendChild(mini);

      left.appendChild(dot); left.appendChild(tx);

      var right = document.createElement('div'); right.className='badges';
      if(s.highlight){
        var hot = document.createElement('span'); hot.className='badge hot'; hot.textContent='강추';
        right.appendChild(hot);
      }
      var tag;
      if(s.budget && s.budget>0){
        tag = document.createElement('span'); tag.className='badge'; tag.textContent = currency(s.budget);
      }else{
        tag = document.createElement('span'); tag.className='badge free'; tag.textContent = 'Free';
      }
      right.appendChild(tag);

      item.appendChild(left); item.appendChild(right);
      list.appendChild(item);
    }

    var row = document.createElement('div'); row.className='row-sum';
    var chip = document.createElement('div'); chip.className='chip';
    chip.innerHTML = '<strong>일자 합계</strong> · <span class="sum">'+currency(daySum(obj))+'</span>';
    row.appendChild(chip);

    body.appendChild(list); body.appendChild(row);
    wrap.appendChild(h); wrap.appendChild(body);
    return wrap;
  }

  function buildUI(){
    var i;
    controls.innerHTML = '';
    panels.innerHTML = '';
    for(i=0;i<itinerary.length;i++){ controls.appendChild( makeDayButton(itinerary[i], i) ); }
    for(i=0;i<itinerary.length;i++){ panels.appendChild( makePanel(itinerary[i], i) ); }
  }

  /* ===== 지도 ===== */
  function initMap(){
    map = L.map('map',{ zoomControl:true, scrollWheelZoom:true }).setView([13.511,144.805], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19, attribution:'© OpenStreetMap' }).addTo(map);
    markerLayer = L.layerGroup().addTo(map);
    currentMarkers = [];
  }

  function iconByType(t){
    var color = '#06b6d4';
    if(t==='bbq') color='#f59e0b';
    else if(t==='burger') color='#16a34a';
    else if(t==='poke') color='#0ea5e9';
    else if(t==='market') color='#a78bfa';
    else if(t==='hotel') color='#f472b6';
    else if(t==='pool') color='#60a5fa';
    else if(t==='beach') color='#34d399';
    else if(t==='spot') color='#ef4444';
    else if(t==='cafe') color='#94a3b8';
    else if(t==='mall') color='#8b5cf6';
    var html = '<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="'+color+'" stroke="black" stroke-width="0.5"><path d="M12 2c3.9 0 7 3.1 7 7 0 5.2-7 13-7 13S5 14.2 5 9c0-3.9 3.1-7 7-7zm0 9.5c1.4 0 2.5-1.1 2.5-2.5S13.4 6.5 12 6.5 9.5 7.6 9.5 9 10.6 11.5 12 11.5z"/></svg>';
    return L.divIcon({ html: html, className:'mkr', iconSize:[26,26], iconAnchor:[13,26], popupAnchor:[0,-20] });
  }

  function loadMarkers(day){
    markerLayer.clearLayers();
    currentMarkers = [];
    var obj = getDay(day), bounds = [], i;
    for(i=0;i<obj.steps.length;i++){
      var s = obj.steps[i];
      var m = L.marker([s.lat, s.lng], { icon: iconByType(s.type), title: s.name }).addTo(markerLayer);
      m.bindPopup('<strong>'+s.name+'</strong><br>'+s.info);
      m.on('mouseover', function(e){
        e.target.openPopup();
        showHover(e.target.options.title, e.target.getPopup().getContent().replace(/<[^>]*>?/gm,''), e.target.getLatLng().lat, e.target.getLatLng().lng);
      });
      m.on('mouseout', function(){ hideHover(); });
      currentMarkers.push(m); bounds.push([s.lat, s.lng]);
    }
    if(bounds.length){ map.fitBounds(bounds, { padding:[28,28] }); }
  }

  function focusMarker(lat,lng){
    var i;
    for(i=0;i<currentMarkers.length;i++){
      var p = currentMarkers[i].getLatLng();
      if(Math.abs(p.lat-lat)<0.0009 && Math.abs(p.lng-lng)<0.0009){
        currentMarkers[i].openPopup();
        map.panTo([lat,lng], { animate:true, duration:.35 });
        break;
      }
    }
  }

  /* ===== 예산 ===== */
  function renderBudget(day){
    var box = document.getElementById('budgetBox');
    var obj = getDay(day);
    var i, html = '';
    html += '<div class="row-sum">';
    for(i=0;i<obj.steps.length;i++){
      var s = obj.steps[i];
      if(s.budget && s.budget>0){
        html += '<div class="chip"><strong>'+s.name+'</strong> · '+currency(s.budget)+'</div>';
      }
    }
    html += '</div>';
    html += '<div class="row-sum"><div class="chip"><strong>DAY '+day+' 합계</strong> · <span class="sum">'+currency(daySum(obj))+'</span></div></div>';
    html += '<div class="row-sum"><div class="chip" style="background:#e8fff2;border-color:#bbf7d0"><strong>전체 합계</strong> · <span class="sum">'+currency(totalSum())+'</span></div></div>';
    box.innerHTML = html;
  }

  /* ===== Hover 패널 ===== */
  function showHover(title, text, lat, lng){
    var box = document.getElementById('hoverFixed');
    document.getElementById('hoverTitle').textContent = title;
    document.getElementById('hoverText').textContent = typeof text==='string' ? text : '';
    if(box.className.indexOf('show')===-1){ box.className += ' show'; }
    if(typeof lat==='number' && typeof lng==='number'){ focusMarker(lat, lng); }
  }
  function hideHover(){
    var box = document.getElementById('hoverFixed');
    box.className = box.className.replace(' show','');
  }

  /* ===== 초기화 ===== */
  document.addEventListener('DOMContentLoaded', function(){
    reorderAllDays();
    buildUI();
    initMap();
    activateDay(1);
  });

  function activateDay(day){
    var i, btns = document.querySelectorAll('.daybtn'), ps = document.querySelectorAll('.panel');
    for(i=0;i<btns.length;i++){
      if(parseInt(btns[i].getAttribute('data-day'),10)===day){ btns[i].classList.add('active'); }
      else{ btns[i].classList.remove('active'); }
    }
    for(i=0;i<ps.length;i++){
      if((i+1)===day){ ps[i].classList.add('active'); }
      else{ ps[i].classList.remove('active'); }
    }
    loadMarkers(day);
    renderBudget(day);
    hideHover();
  }
</script>
</body>
</html>
